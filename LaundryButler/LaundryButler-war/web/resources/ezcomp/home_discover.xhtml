<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

  <!-- INTERFACE -->
  <cc:interface>
  </cc:interface>

  <!-- IMPLEMENTATION -->
  <cc:implementation>
    <h:form id="cartLineItem" class="form">
    <div id="discover" class="container-fluid subscreen bg-grey">
            <div class="text-center">
                <h2>Discovery</h2>
                <h4>Choose a payment plan that works for you</h4>
            </div>
    <div class="row">
      <ui:repeat var="current1" value="#{productManagedBean.products1}" size="3">
        <div class="col-sm-4 col-xs-12">
        <div class="panel panel-default text-center">
          <div class="panel-heading">
            <h1><h:outputText value="#{current1.name}"/></h1>
          </div>
          <div class="panel-body">
            <p><strong><h:outputText value="#{current1.description}"/></strong></p>
          </div>
          <div class="panel-footer">
            <h3>$<h:outputText value="#{current1.price}"/></h3>
            <h:commandButton type="button" class="btn btn-default" style="width:80px;" value="Add" actionListener="#{customerCartManagedBean.addProductToCart(current1)}" >
                <f:ajax render="@form cartLineItemListView"/>
              </h:commandButton>
          </div>
        </div>      
      </div>  
      </ui:repeat>
    </div>
    
    <div class="row">
      <ui:repeat var="current2" value="#{productManagedBean.products2}" size="3">
        <div class="col-sm-4 col-xs-12">
        <div class="panel panel-default text-center">
          <div class="panel-heading">
            <h1><h:outputText value="#{current2.name}"/></h1>
          </div>
          <div class="panel-body">
            <p><strong><h:outputText value="#{current2.description}"/></strong></p>
          </div>
          <div class="panel-footer">
            <h3>$<h:outputText value="#{current2.price}"/></h3>
          <h:commandButton type="button" class="btn btn-default" style="width:80px;" value="Add" actionListener="#{customerCartManagedBean.addProductToCart(current2)}" >
            <f:ajax render="@form cartLineItemListView"/>
              </h:commandButton>
          </div>
        </div>      
      </div>  
      </ui:repeat>
    </div>
            </div>

    <!-- Modal windows-->
      <div class="modal fade" id="myShoppingCart" role="dialog" style="padding-top:100px;">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header themeBg">
              <button type="button" class="close modal-close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title text-center">My Cart</h4>
            </div>
            <h:form id='cartLineItemListView'>
            <div class="modal-body">
              
              <ui:fragment rendered="#{!customerCartManagedBean.isCartEmpty()}">
                <table class="table table-hover text-center">
                  <tbody>
                  <ui:repeat var="item" value="#{customerCartManagedBean.refreshList()}">
                  <tr data-toggle="collapse" data-target="#myCartToggle#{item.cartLineItemId}" class="accordion-toggle">
                    <td>
                      <h:outputText value="#{item.product.name}"/>
                    </td>
                    <td>
                      <span class="glyphicon glyphicon-plus"></span>
                      <h:outputText value="#{item.quantity}"/>
                      <span class="glyphicon glyphicon-minus"></span>
                    </td>
                    <td>
                      <h:outputText value="#{item.product.price * item.quantity}"/>
                    </td>
                    <td>
                      <i class="indicator glyphicon chevron_toggleable glyphicon-chevron-up pull-right"></i>
                    </td>
                  </tr>
                  <tr>
                <td colspan="6" class="hiddenRow">
                  <div id="myCartToggle#{item.cartLineItemId}" class="accordian-body collapse">    
                    <div class="row" style="padding-left:50px;padding-right:40px;text-align:left;">
                      <h:outputText value="#{item.quantity}"/>
                    </div>
                  </div>
                </td>
              </tr>
                    
                </ui:repeat>
                  </tbody>
                </table>
                <script>
                  $('.chevron_toggleable').on('click', function () {
                    $(this).toggleClass('glyphicon-chevron-down glyphicon-chevron-up');
                  });
                </script>
              </ui:fragment>
              <ui:fragment rendered="#{customerCartManagedBean.isCartEmpty()}">
                <p class="text-center">Your cart is empty.</p>
              </ui:fragment>
            </div>
            <div class="modal-footer">
              <h:commandButton type="button" class="btn btn-default page_button" style="width:80px;" value="Save">
                <f:ajax execute="@form"/>
              </h:commandButton>
              <button type="button" class="btn btn-default" data-dismiss="modal" style="width:80px;">Cancel</button>
              
            </div>
            </h:form>
          </div>
        </div>
      </div>
    </h:form>
  </cc:implementation>
</html>